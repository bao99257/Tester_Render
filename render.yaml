services:
  # Database service
  - type: pserv
    name: mysql
    plan: standard
    env: docker
    disk:
      name: mysql-data
      mountPath: /var/lib/mysql
      sizeGB: 10
    envVars:
      - key: MYSQL_ROOT_PASSWORD
        value: vtat2011
      - key: MYSQL_DATABASE
        value: jgps_rudra

  # Main application service
  - type: web
    name: jgps-app
    env: docker
    plan: standard
    dockerfilePath: Dockerfile
    dockerContext: .
    healthCheckPath: /actuator/health
    numInstances: 1
    dependsOn:
      - mysql
    envVars:
      - key: SPRING_DATASOURCE_URL
        value: jdbc:mysql://mysql:3306/jgps_rudra?createDatabaseIfNotExist=true
      - key: SPRING_DATASOURCE_USERNAME
        value: root
      - key: SPRING_DATASOURCE_PASSWORD
        value: vtat2011
    startCommand: "java -cp library.jar bd.edu.diu.cis.library.LibraryApplication & sleep 30 && java -cp admin.jar bd.edu.diu.cis.admin.AdminApplication & java -cp customer.jar bd.edu.diu.cis.customer.CustomerApplication"

